#include "stm32f4xx.h"	//bibliotecas padrão STM32F4
#include "stdio.h"
#include "Utility.h"	//biblioteca de funções utilitárias
#include "Sound.h"

int main(void)
{

	Configure_Clock(); //configura o sistema de clock
	Delay_Start(); //inicializa funções de Delay

	RCC->AHB1ENR |= 1;
	 //habilita o clock do GPIOA
	GPIOA->MODER |= 0b11 << 10; //inicialização do pino PA4 no modo analógico

	RCC->APB1ENR |= 1 << 29; //habilita o clock da interface digital do DAC
	DAC->CR |= DAC_CR_EN2; //habilita o canal 2 do DAC

	const uint16_t samples[200] = {2482,2501,2521,2540,2560,2579,2598,2617,2636,2655,2674,2692,2710,2728,
			2746,2763,2781,2798,2814,2831,2847,2862,2877,2892,2907,2921,2934,2947,2960,2972,2984,2995,3006,
			3016,3026,3035,3043,3051,3059,3066,3072,3078,3083,3087,3091,3095,3097,3100,3101,3102,3102,3102,
			3101,3100,3097,3095,3091,3087,3083,3078,3072,3066,3059,3051,3043,3035,3026,3016,3006,2995,2984,
			2972,2960,2947,2934,2921,2907,2892,2877,2862,2847,2831,2814,2798,2781,2763,2746,2728,2710,2692,
			2674,2655,2636,2617,2598,2579,2560,2540,2521,2501,2482,2462,2443,2423,2404,2385,2366,2346,2328,
			2309,2290,2272,2253,2235,2218,2200,2183,2166,2149,2133,2117,2102,2086,2071,2057,2043,2030,2016,
			2004,1992,1980,1969,1958,1948,1938,1929,1920,1912,1905,1898,1892,1886,1881,1876,1872,1869,1866,
			1864,1863,1862,1861,1862,1863,1864,1866,1869,1872,1876,1881,1886,1892,1898,1905,1912,1920,1929,
			1938,1948,1958,1969,1980,1992,2004,2016,2030,2043,2057,2071,2086,2102,2117,2133,2149,2166,2183,
			2200,2218,2235,2253,2272,2290,2309,2328,2346,2366,2385,2404,2423,2443,2462}
;

	while(1)
	{
		for(int i = 0; i < 200; i++){
			DAC -> DHR12R2 = samples[i]; //Escreve no DAC2
			Delay_us(18); //aguarda para a próxima amostra
		}
	}
}
